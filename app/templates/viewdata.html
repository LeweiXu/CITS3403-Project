{% extends "base.html" %}

{% block title %}MediaTracker - View Data{% endblock %}

{% block content %}
<div class="page-container">
    <h2 class="text-center page-title">Your Media Entries</h2>
    <section class="section wow fadeIn" data-wow-duration="0.2s" data-wow-delay="0.05s">
        <!-- Search Bar -->
        <form action="{{ url_for('viewdata') }}" method="GET" class="mb-4">
            <div class="row">
                <div class="col-md-2">
                    <label for="start_date" class="form-label">Start Date</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" value="{{ request.args.get('start_date', '') }}">
                </div>
                <div class="col-md-2">
                    <label for="end_date" class="form-label">End Date</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" value="{{ request.args.get('end_date', '') }}">
                </div>
                <div class="col-md-2">
                    <label for="media_name" class="form-label">Media Name</label>
                    <input type="text" id="media_name" name="media_name" class="form-control" placeholder="e.g., Inception" value="{{ request.args.get('media_name', '') }}">
                </div>
                <div class="col-md-2">
                    <label for="media_type" class="form-label">Media Type</label>
                    <input type="text" id="media_type" name="media_type" class="form-control" placeholder="e.g., Movie" value="{{ request.args.get('media_type', '') }}">
                </div>
                <div class="col-md-2">
                    <label for="min_duration" class="form-label">Min Duration</label>
                    <input type="number" id="min_duration" name="min_duration" class="form-control" placeholder="e.g., 30" value="{{ request.args.get('min_duration', '') }}">
                </div>
                <div class="col-md-2">
                    <label for="max_duration" class="form-label">Max Duration</label>
                    <input type="number" id="max_duration" name="max_duration" class="form-control" placeholder="e.g., 120" value="{{ request.args.get('max_duration', '') }}">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12 text-center">
                    <button type="submit" class="btn btn-primary">Search</button>
                    <a href="{{ url_for('viewdata') }}" class="btn btn-secondary">Reset</a>
                </div>
            </div>
        </form>
    </section>  

    <section class="table-section wow fadeIn" data-wow-duration="0.2s" data-wow-delay="0.1">
        <table class="table table-striped mt-4">
            <thead>
                <tr>
                    <th class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.05s">Date</th>
                    <th class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.1s">Media Type</th>
                    <th class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.15s">Media Name</th>
                    <th class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.2s">Duration (minutes)</th>
                    <th class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.25s">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr>
                    <td class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.05s">{{ entry.date }}</td>
                    <td class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.1s">{{ entry.activity.media_type }}</td>
                    <td class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.15s">{{ entry.activity.media_name }}</td>
                    <td class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.2s">{{ entry.duration }}</td>
                    <td class="wow fadeInUp" data-wow-duration="0.2s" data-wow-delay="0.25s">
                        <a href="{{ url_for('delete_entry', entry_id=entry.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this entry?');">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if total_pages > 1 %}
            <nav aria-label="Pagination">
            <ul class="pagination justify-content-center mt-4">
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link"
                    href="{{ url_for(request.endpoint, page=page-1, **request_args) }}">
                    &laquo; Prev
                    </a>
                </li>
                {% endif %}
                {% for p in range(1, total_pages+1) %}
                <li class="page-item {% if p==page %}active{% endif %}">
                    <a class="page-link"
                    href="{{ url_for(request.endpoint, page=p, **request_args) }}">
                    {{ p }}
                    </a>
                </li>
                {% endfor %}
                {% if page < total_pages %}
                <li class="page-item">
                    <a class="page-link"
                    href="{{ url_for(request.endpoint, page=page+1, **request_args) }}">
                    Next &raquo;
                    </a>
                </li>
                {% endif %}
            </ul>
            </nav>
            {% endif %}
    </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Toggle visibility of the advanced section
        const toggleAdvanced = document.getElementById('toggle-advanced');
        const advancedContent = document.getElementById('advanced-content');

        toggleAdvanced.addEventListener('click', () => {
            advancedContent.classList.toggle('hidden');
        });
    });

    // Drag-and-drop functionality for CSV upload
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('csvFile');
    const browseBtn = document.getElementById('choose-file-btn');

    // “Browse files” button opens native picker
    browseBtn.addEventListener('click', () => fileInput.click());

    // Highlight when dragging files over
    ['dragenter', 'dragover'].forEach(evt =>
        dropZone.addEventListener(evt, e => {
            e.preventDefault();
            dropZone.classList.add('hover');
        })
    );

    // Remove highlight on leave or drop
    ['dragleave', 'drop'].forEach(evt =>
        dropZone.addEventListener(evt, e => {
            e.preventDefault();
            dropZone.classList.remove('hover');
        })
    );

    // On file drop, assign to hidden input + show filename
    dropZone.addEventListener('drop', e => {
        const files = e.dataTransfer.files;
        if (!files.length) return;
        fileInput.files = files;
        dropZone.querySelector('p').textContent = files[0].name;
    });
</script>
{% endblock %}